# Amazon S3 Output Plugin

The `out_s3` plugin is a buffered output plugin used to write records into the Amazon S3 cloud object storage service.

## Installation

td-agent includes the S3 plugin by default. Fluentd users will need to install the fluent-plugin-s3 gem using the following command:

    :::term
    $ fluent-gem install fluent-plugin-s3

## Example Configuration

    :::text
    <match pattern>
      type s3

      aws_key_id YOUR_AWS_KEY_ID
      aws_sec_key YOUR_AWS_SECRET/KEY
      s3_bucket YOUR_S3_BUCKET_NAME
      s3_endpoint s3-us-west-1.amazonaws.com
      path logs/
      buffer_path /var/log/fluent/s3

      time_slice_format %Y%m%d-%H
      time_slice_wait 10m
      utc

      buffer_chunk_limit 256m
    </match>

Please refer to the [Store Apache Logs into Amazon S3](apache-to-s3) article for real-world use cases.

NOTE: Please refer to the <a href="config-file">Config File</a> article for more information on the basic structure and syntax of the configuration file.

NOTE: Files are created on an hourly basis (depending on `time_slice_format`). This means that when you first import records using the plugin, no file is created immediately. The file will be created when the `time_slice_format` condition has been met.

NOTE: Make sure you have <b>enough space in the buffer_path directory</b>. Running out of space is a frequent problem reported by users.

## Parameters

### type (required)
The value must be `s3`.

### aws_key_id (required)
AWS access key id.

### aws_sec_key (required)
AWS secret key.

### s3_bucket (required)
Amazon S3 bucket name.

### buffer_path (required)
Path prefix of the log buffer files.

### s3_endpoint
Amazon S3 endpoint name. Please select the appropriate endpoint name from the list below and confirm that your bucket has been created in the correct region.

* s3.amazonaws.com
* s3-us-west-1.amazonaws.com
* s3-us-west-2.amazonaws.com
* s3.sa-east-1.amazonaws.com
* s3-eu-west-1.amazonaws.com
* s3-ap-southeast-1.amazonaws.com
* s3-ap-northeast-1.amazonaws.com

### time_slice_format
The time format used as the file name. The default is `%Y%m%d`. Use `%Y%m%d%H` to split files on an hourly basis.

### time_slice_wait
The amount of time to wait for old logs. This is used to account for delays in logs arriving to your Fluentd node. The default is 10 minutes ('10m'), meaning that Fluentd will wait until 10 minutes past the hour for any logs that occured during the past hour.

For example, a log recorded at 1:59 but arriving at the Fluentd node after 2:00 but before 2:10 will be uploaded together with all the other logs from 1:00 to 1:59 in one transaction, avoiding extra overhead). Larger values can be set as needed.

### path
Path prefix of the files on S3. The default is “” (no prefix).

NOTE: The actual path on S3 will be: “{path}{time_slice_format}_{sequential_number}.gz”

### utc
Use UTC instead of local time.

## Buffer Parameters
For advanced usage, you can tune Fluentd's internal buffering mechanism by these parameters.

### buffer_type
`file` by default ([buf_file](buf_file)). You can use `memory` ([buf_memory](buf_memory)) as well. Please specify `buffer_path` when you use `file` buffer.

### buffer_queue_limit, buffer_chunk_limit
The length of the chunk queue, and the size of each chunk. See [Buffer Plugin Overview](buffer-plugin-overview) for the basic buffer structure. Default is 256 and 8m. Suffixes “k” (KB), “m” (MB), “g” (GB) can be used.

### retry_wait and retry_limit
The interval between retries, and the number of retries. Default is 1.0 and 17. `retry_wait` gets doubled between each retry (e.g. the last retry waits for 131072 sec).

## Futher Reading
- [fluent-plugin-s3 repository](https://github.com/fluent/fluent-plugin-s3)
